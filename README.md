# Rust 嵌入式开发之无人机

这是一个使用 STM32F103C8T6 单片机以 Rust 开发语言开发无人机的项目，实现一个无人机的飞行控制程序，使其能够稳定地飞行，并通过遥控器进行操控。

注意：由于使用了 RTIC 所以需要使用 rust nightly 版本。

## 待处理

- [x] 硬件电源开关/软件开关（教材）
  - [x] 点亮 2 个 LED 灯
- [ ] 定时器+串口-通用后台控制程序框架

  - [ ] 指令: set 指令编号=参数 / get 指令编号
    - 设置电机速度: set 5=5
    - 获取电机速度：get 6

- [x] PWM

  - [x] 串口设置转速
  - [x] 同时控制电机

- [x] 电机芯片

  - [x] 正转
  - [x] 反转, 引脚紧张暂不支持动态反转
  - [x] 刹车 low-low（刹车）, 同上

- [ ] ESP32 WIFI 通信

  - [ ] 开发板转发消息到 wifi 模块
  - [ ] 使用串口软件与开发板通讯

- [ ] NRF24L01 通信

  - [ ] 接收数据
    - [ ] Usart 转发无线消息到 pc
    - [ ] 根据命令控制飞机上的 led 灯
  - [ ] 对频
    - [ ] 控制蜂鸣器，飞控开机开始对频，默认间断蜂鸣，对频成功后停止

- [ ] 手柄

  - [ ] 对频
  - [ ] 发送数据
    - NRF24L01 处于发送模式
    - 默认会一直发送数据，发送为[0;32], 当有数据时，对应的索引值发生变化
    - 摇杆输入
    - 按键输入

- [ ] 编码器

  - [ ] 监测直流电机的转速
    - [ ] 定时器配置为编码器接口模式
    - [ ] 在规定时间内读取电机速度传感器返回的脉冲个数
    - [ ] 根据 M 法进行速度求解
  - [ ] 电机自身对转速的限制（机械受力强度）
  - [ ] 用户界面显示需要
    - [ ] 实时显示直流电机实际速度到串口

- [ ] pid 控制算法了解
  - 增量式 PID 控制算法

## 硬件平台

- 无人机的机架
- 单片机 STM32F103C8T6
- 六轴运动传感器 MPU6050
- 电机驱动 TB6612FNG (2 个)
- 直流电机&螺旋桨 (4 对)
- 无线通信 NRF240L01 2.4G
- 存储芯片 W25Q64 (待定)
- ESP8266 WIFI (待定)
- ESP-01S WIFI 模块 (待定)
- 手柄遥控器 2.4G
- 蓝牙遥控
- GPS
- 陀螺仪
- 气压计
- 加速度计
- 电机空心杯
- 超声波
- 电调
- 电池
- 云台
- 摄像头视频采集
- LED 灯
- 蜂鸣器
- 参考项目: Butterfly 无人机

## 功能设计

- WIFI 通讯
- 手柄控制开发板
- PID 算法：是一种常用的控制算法，它可以根据设备的实际输出和期望输出之间的误差，通过比例（P）、积分（I）和微分（D）三个环节的调节，使设备的输出达到稳定和精确的控制。PID 算法的应用领域非常广泛，如温度控制、速度控制、位置控制等。
- 飞行控制
- 姿态估计
- 遥控通信
- 传感器读取

接收遥控信号、读取传感器数据、执行飞行算法、控制电机转速

## 测试

测试和调试无人机，连接遥控器和无人机，给无人机上电，观察无人机的运行情况，检查是否有错误或异常。

规划无人机项目，包括需求分析、设计、开发等阶段的时间和任务。

## 参考文档

- [RTIC RTOS](https://rtic.rs/2/book/en/preface.html)
- [物联网嵌入式开发基础到项目实战：7 无人机项目] (https://www.bilibili.com/video/BV1Gy4y117jg?p=1&vd_source=c459b4f4f90bc42bb5ddb5baf12e1bc7)
